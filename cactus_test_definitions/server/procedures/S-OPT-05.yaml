Description: S-OPT-05 Update Telemetry Post Rates
Category: Monitoring
Classes:
 - A

TargetVersions:
 - v1.2

Preconditions:
  required_clients:
    - id: client

Steps:
  - id: PRECONDITION
    repeat_until_pass: true
    instructions:
      - Register an end device
    action: 
      type: discovery
      parameters:
        resources:
          - EndDevice
          - DER
          - MirrorUsagePoint
    checks:
      - type: end-device 
        parameters:
          matches_client: true

  - id: CREATE MUP
    action: 
      type: upsert-mup
      parameters:
        mup_id: mupa
        location: Device
        reading_types: 
          - ActivePowerAverage
    checks:
      - type: mirror-usage-point
        parameters:
          matches: true
    
  - id: ENSURE MUP POLLRATE
    repeat_until_pass: true
    instructions:
      - The utility server shall be configured to change all default MirrorUsagePoint post-rates for the test client to 60s.
    action: 
      type: refresh-resource
      parameters:
        resource: MirrorUsagePoint
    checks:
      - type: mirror-usage-point
        parameters:
          matches: true
          post_rate_seconds: 60

  - id: UPDATE-MUP-POLLRATE
    repeat_until_pass: true
    instructions:
      - The utility server shall be configured to change all default MirrorUsagePoint post-rates for the test client from 60s to 300s.
    action: 
      type: refresh-resource
      parameters:
        resource: MirrorUsagePoint
    checks:
      - type: mirror-usage-point
        parameters:
          matches: true
          poll_rate_seconds: 300
